<!DOCTYPE html>
<html>
<head>
    <title>å®¶åº­è²¡å¯Œå„€è¡¨æ¿</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-light">

<div class="container mt-5">
    <h1 class="text-center mb-3">ğŸš€ å®¶åº­è²¡å¯Œæ¨¡æ“¬å ±å‘Š</h1>
    
    <div class="d-flex justify-content-center mb-4">
        <div class="alert alert-secondary py-2 px-4 shadow-sm">
            ç›®å‰åƒæ•¸è¨­å®šï¼š
            <span class="badge bg-success ms-2">é æœŸå ±é…¬ç‡ {{ settings.return_rate }}%</span>
            <span class="badge bg-danger ms-2">é ä¼°é€šè†¨ç‡ {{ settings.inflation_rate }}%</span>
        </div>
    </div>

    <div class="row text-center mb-4">
        <div class="col-md-3">
            <a href="{% url 'asset_list' %}" class="btn btn-outline-success w-100 py-3 shadow-sm">
                ğŸ’° åˆå§‹è³‡ç”¢ç®¡ç†
            </a>
        </div>
        <div class="col-md-3">
            <a href="{% url 'income_list' %}" class="btn btn-outline-info w-100 py-3 shadow-sm">
                ğŸ“Š æ¯æœˆæ”¶æ”¯ç®¡ç†
            </a>
        </div>
        <div class="col-md-3">
            <a href="{% url 'goal_list' %}" class="btn btn-outline-primary w-100 py-3 shadow-sm">
                ğŸ¯ äººç”Ÿç›®æ¨™ç®¡ç†
            </a>
        </div>
        <div class="col-md-3">
            <a href="{% url 'settings_edit' %}" class="btn btn-secondary w-100 py-3 shadow-sm">
                âš™ï¸ è¨­å®šæ¨¡æ“¬åƒæ•¸
            </a>
        </div>
    </div>

    <div class="card shadow mb-4">
        <div class="card-body">
            <h4 class="card-title text-center text-secondary">è³‡ç”¢ç´¯ç©è¶¨å‹¢åœ–</h4>
            <canvas id="wealthChart" style="max-height: 400px;"></canvas>
        </div>
    </div>

    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card p-3 border-primary shadow-sm">
                <h5>ğŸ’° åˆå§‹ç¸½è³‡ç”¢</h5>
                <h3 class="text-primary">${{ initial_wealth }}</h3>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card p-3 border-success shadow-sm">
                <h5>ğŸ· æ¯å¹´å­˜éŒ¢èƒ½åŠ›</h5>
                <h3 class="text-success">${{ yearly_savings }}</h3>
            </div>
        </div>
    </div>

    <div class="card shadow">
        <div class="card-body">
            <table class="table table-striped table-hover">
                <thead class="table-dark">
                    <tr>
                        <th>å¹´ä»½</th>
                        <th>å¹´é½¡</th>
                        <th>é‡å¤§æ”¯å‡ºäº‹ä»¶</th>
                        <th>ç•¶å¹´åº¦çµé¤˜</th>
                        <th>ç´¯ç©è³‡ç”¢ (é æ¸¬)</th>
                    </tr>
                </thead>
                <tbody>
                    {% for row in report_data %}
                    <tr>
                        <td>{{ row.year }}</td>
                        <td>{{ row.age }} æ­²</td>
                        <td>
                            {% if row.events != "-" %}
                                <span class="badge bg-warning text-dark">{{ row.events }}</span>
                            {% else %}
                                -
                            {% endif %}
                        </td>
                        <td>${{ row.savings }}</td>
                        <td class="fw-bold {% if row.is_negative %}text-danger{% else %}text-primary{% endif %}">
                            ${{ row.wealth }}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    const ctx = document.getElementById('wealthChart').getContext('2d');
    const years = {{ chart_years|safe }};
    const wealths = {{ chart_wealth|safe }};

    new Chart(ctx, {
        type: 'line',
        data: {
            labels: years,
            datasets: [{
                label: 'é æ¸¬ç¸½è³‡ç”¢',
                data: wealths,
                borderColor: 'rgba(54, 162, 235, 1)',
                backgroundColor: 'rgba(54, 162, 235, 0.2)',
                borderWidth: 2,
                fill: true,
                tension: 0.3
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: false,
                    grid: {
                        color: (context) => {
                            if (context.tick.value === 0) return 'red';
                            return 'rgba(0, 0, 0, 0.1)';
                        }
                    }
                }
            }
        }
    });
</script>

</body>
</html>